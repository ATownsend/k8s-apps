apiVersion: v1
kind: Pod
metadata:
  name: {{ printf "tweeviz-api-test-%s" .Release.Name | trunc 55 | trimSuffix "-" }}
  annotations:
    helm.sh/hook: test-success
spec:
  containers:
    - name: kafka-test
      image: {{ .Values.image.repository }}{{ .Values.image.name }}:{{ .Values.image.tag }}
      imagePullPolicy: {{ .Values.image.pullPolicy }}
      command:  ["sh", "-cx", "until wget -O - -T {{ .Values.probePeriodSeconds }} -q {{ template "tweeviz.api.fullname" . }}:{{ .Values.port }}/stats | grep weight ; do sleep 10; done;"]
  restartPolicy: Never
