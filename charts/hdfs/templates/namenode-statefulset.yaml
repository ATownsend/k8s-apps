apiVersion: v1
kind: Service
metadata:
  name: hdfs-namenode
  labels:
    app: hdfs-namenode
spec:
  ports:
  - port: 8020
    name: fs
  clusterIP: None
  selector:
    app: hdfs-namenode
---
apiVersion: v1
kind: Service
metadata:
  name: hdfs-ui
  labels:
    app: hdfs-ui
spec:
  type: NodePort
  ports:
  - port: 50070
    name: ui
  selector:
    app: hdfs-namenode
---
apiVersion: apps/v1beta1
kind: StatefulSet
metadata:
  name: hdfs-namenode
spec:
  serviceName: "hdfs-namenode"
  replicas: 1
  template:
    metadata:
      labels:
        app: hdfs-namenode
    spec:
      terminationGracePeriodSeconds: 0
      containers:
        - name: hdfs-namenode
          image: uhopper/hadoop-namenode:2.7.2
          env:
            - name: CLUSTER_NAME
              value: hdfs-k8s
            - name: HDFS_CONF_dfs_namenode_datanode_registration_ip___hostname___check
              value: "false"
            - name: HDFS_CONF_dfs_client_use_datanode_hostname
              value: "false"
            - name: HDFS_CONF_dfs_datanode_use_datanode_hostname
              value: "false"
          ports:
          - containerPort: 8020
            name: fs
          volumeMounts:
            - name: hdfs-configs
              mountPath: /etc/hadoop/hdfs-site.xml
              subPath: hdfs-site.xml
          #  - name: hdfs-name
          #    mountPath: /hadoop/dfs/name
      volumes:
        - configMap:
            name: hdfs-configs
            items:
            - key: hdfs-site.xml
              path: hdfs-site.xml
          name: hdfs-configs
      #  - name: hdfs-name
      #    hostPath:
      #      path: {{ .Values.nameNodeHostPath }}
